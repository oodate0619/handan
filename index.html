<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>åˆ¤æ–­ã‚’æ—©ã‚ã‚‹æ•´ç†ãƒ‡ãƒ¢ï¼ˆç¬¬3å·ï¼‰</title>
  <meta name="description" content="éƒ¨ä¸‹ã®ãƒ¡ãƒ¢ã‚„è³‡æ–™ã‚’ã€åˆ¤æ–­ã«å¿…è¦ãªãƒã‚¤ãƒ³ãƒˆã ã‘ã«æ•´ç†ã™ã‚‹ä½“æ„Ÿãƒ‡ãƒ¢ã€‚ç¤¾å†…ã§ä½¿ã‚ã›ã¦è‰¯ã„ã‹ã‚’3åˆ†ã§åˆ¤æ–­ã€‚" />
  <style>
    :root{
      --bg:#ffffff;
      --panel:#f7f8fa;
      --panel2:#ffffff;
      --text:#111827;
      --muted:#6b7280;
      --line:#e5e7eb;
      --accent:#2563eb;
      --accent2:#0ea5e9;
      --ok:#16a34a;
      --warn:#f59e0b;
      --bad:#ef4444;
      --shadow: 0 10px 30px rgba(0,0,0,.06);
      --radius: 18px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI",
        Roboto, "Noto Sans JP", "Hiragino Sans", "Yu Gothic", "Meiryo", Arial, sans-serif;
      color:var(--text);
      background:linear-gradient(180deg,#fff 0%, #fafafa 100%);
    }
    a{color:var(--accent); text-decoration:none}
    .wrap{max-width:980px;margin:0 auto;padding:18px 14px 40px}
    .top{
      display:flex; flex-direction:column; gap:10px;
      padding:16px 14px; border:1px solid var(--line);
      border-radius:var(--radius); background:var(--panel2);
      box-shadow: var(--shadow);
    }
    .title{font-size:20px; font-weight:800; letter-spacing:.2px}
    .subtitle{font-size:14px; color:var(--muted); line-height:1.5}
    .pillrow{display:flex; gap:8px; flex-wrap:wrap; margin-top:4px}
    .pill{
      font-size:12px; color:#0f172a;
      background:#eef2ff; border:1px solid #e0e7ff;
      padding:6px 10px; border-radius:999px;
    }
    .note{
      font-size:12px; color:var(--muted);
      padding-top:2px;
    }

    /* safety banner */
    .safety{
      margin-top:12px;
      padding:12px 12px;
      border:1px solid #fde68a;
      background:#fffbeb;
      border-radius:14px;
    }
    .safety h3{
      margin:0 0 6px 0;
      font-size:13px;
      display:flex; align-items:center; gap:8px;
    }
    .safety ul{
      margin:0; padding-left:18px; color:#7c2d12;
      font-size:13px; line-height:1.5;
    }
    .safety .hint{margin-top:8px;color:#92400e;font-size:12px}

    .grid{
      margin-top:14px;
      display:grid;
      grid-template-columns: 1fr;
      gap:12px;
    }
    @media (min-width: 900px){
      .grid{grid-template-columns: 1.05fr .95fr}
    }

    .card{
      background:var(--panel2);
      border:1px solid var(--line);
      border-radius:var(--radius);
      box-shadow: var(--shadow);
      padding:14px;
    }
    .card h2{
      margin:0 0 10px 0;
      font-size:14px;
      display:flex; justify-content:space-between; align-items:center;
    }
    .badge{
      font-size:11px; color:#0f172a;
      background:#f1f5f9;
      border:1px solid #e2e8f0;
      padding:4px 8px; border-radius:999px;
      white-space:nowrap;
    }
    .badge.demo{background:#ecfeff;border-color:#cffafe;color:#155e75}

    .controls{
      display:flex; flex-wrap:wrap; gap:8px; align-items:center;
      margin-bottom:10px;
    }
    .seg{
      display:flex; border:1px solid var(--line); border-radius:999px;
      overflow:hidden; background:#fff;
    }
    .seg button{
      border:0; background:transparent; padding:8px 10px;
      font-size:12px; color:#0f172a; cursor:pointer;
    }
    .seg button.active{
      background:#e0e7ff; color:#1e3a8a; font-weight:700;
    }
    .btn{
      border:1px solid var(--line);
      background:#fff;
      padding:8px 10px;
      border-radius:10px;
      font-size:12px;
      cursor:pointer;
    }
    .btn:hover{border-color:#cbd5e1}
    .btn.primary{
      border-color:#1d4ed8;
      background:linear-gradient(180deg,#2563eb 0%, #1d4ed8 100%);
      color:#fff;
      font-weight:800;
      padding:10px 12px;
    }
    .btn.primary:hover{filter:brightness(1.02)}
    .btn.ghost{
      background:#f8fafc;
    }

    label{
      display:block; font-size:12px; color:#111827; font-weight:700;
      margin-bottom:6px;
    }
    .small{font-size:12px;color:var(--muted); margin-top:4px; line-height:1.4}
    textarea{
      width:100%;
      min-height:170px;
      border:1px solid var(--line);
      border-radius:14px;
      padding:12px;
      font-size:14px;
      line-height:1.5;
      resize:vertical;
      outline:none;
      background:#fff;
    }
    textarea:focus{border-color:#93c5fd; box-shadow:0 0 0 4px rgba(147,197,253,.25)}
    .runrow{
      display:flex; flex-direction:column; gap:8px; margin-top:10px;
    }
    @media (min-width:520px){
      .runrow{flex-direction:row; align-items:center; justify-content:space-between}
    }
    .disclaimer{
      font-size:12px;color:var(--muted); line-height:1.45;
    }
    .disclaimer strong{color:#111827}
    .divider{height:1px;background:var(--line); margin:10px 0}

    .outcard{
      background:var(--panel);
      border:1px solid var(--line);
      border-radius:16px;
      padding:12px;
    }
    .outcard h3{
      margin:0 0 6px 0;
      font-size:13px;
      display:flex; justify-content:space-between; align-items:center; gap:8px;
    }
    .outcard .tag{
      font-size:11px; padding:3px 8px; border-radius:999px;
      border:1px solid #e2e8f0; background:#fff; color:#334155;
      white-space:nowrap;
    }
    .outcard ul{
      margin:0; padding-left:18px;
      font-size:13px; line-height:1.55; color:#0f172a;
    }
    .empty{
      font-size:13px; color:var(--muted); line-height:1.6;
      padding:10px; border:1px dashed #d1d5db; border-radius:14px; background:#fff;
    }

    .decision{
      display:grid;
      grid-template-columns:1fr;
      gap:10px;
      margin-top:12px;
    }
    @media (min-width:520px){
      .decision{grid-template-columns:1fr 1fr}
    }
    .judge{
      border:1px solid var(--line);
      border-radius:16px;
      padding:12px;
      background:#fff;
    }
    .judge h4{margin:0 0 6px 0;font-size:13px}
    .judge p{margin:0;font-size:12px;color:var(--muted);line-height:1.45}
    .judge button{
      margin-top:10px;
      width:100%;
      border-radius:12px;
      padding:10px 12px;
      border:1px solid var(--line);
      background:#fff;
      cursor:pointer;
      font-weight:800;
    }
    .judge button.ok{border-color:#86efac;background:#f0fdf4;color:#14532d}
    .judge button.hold{border-color:#fed7aa;background:#fff7ed;color:#7c2d12}

    .toast{
      position:fixed; left:50%; bottom:16px; transform:translateX(-50%);
      background:#111827; color:#fff; font-size:13px;
      padding:10px 12px; border-radius:12px;
      box-shadow:0 10px 24px rgba(0,0,0,.18);
      opacity:0; pointer-events:none;
      transition:opacity .18s ease, transform .18s ease;
    }
    .toast.show{opacity:1; transform:translateX(-50%) translateY(-4px)}
    .foot{
      margin-top:14px; font-size:12px; color:var(--muted); line-height:1.5;
      text-align:center;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <section class="top" aria-label="ãƒ˜ãƒƒãƒ€ãƒ¼">
      <div class="title">åˆ¤æ–­ã‚’æ—©ã‚ã‚‹æ•´ç†ãƒ‡ãƒ¢</div>
      <div class="subtitle">
        éƒ¨ä¸‹ã®ãƒ¡ãƒ¢ã‚„è³‡æ–™ã‚’ã€Œãã®ã¾ã¾èª­ã¾ãšã«ã€ã€åˆ¤æ–­ã«å¿…è¦ãªãƒã‚¤ãƒ³ãƒˆã ã‘æŠŠæ¡ã§ãã¾ã™ã€‚<br>
        <span class="note">â€» ã“ã®ãƒ‡ãƒ¢ã¯ã€Œè³‡æ–™ä½œæˆã€ã‚„ã€Œçµè«–ã®ä»£è¡Œã€ã¯è¡Œã„ã¾ã›ã‚“ã€‚æœ€çµ‚åˆ¤æ–­ã¯äººãŒè¡Œã†å‰æã§ã™ã€‚</span>
      </div>
      <div class="pillrow" aria-label="è©•ä¾¡è»¸">
        <div class="pill">åˆ¤æ–­ãŒé€Ÿããªã‚‹ã‹</div>
        <div class="pill">äº‹æ•…ã‚‰ãªãã†ã‹</div>
        <div class="pill">éƒ¨ä¸‹ã«ä»»ã›ã‚‰ã‚Œã‚‹ã‹</div>
      </div>

      <div class="safety" role="note" aria-label="å…¥åŠ›ã—ãªã„ã§ãã ã•ã„ï¼ˆä»®ãƒ«ãƒ¼ãƒ«ï¼‰">
        <h3>âš ï¸ å…¥åŠ›ã—ãªã„ã§ãã ã•ã„ï¼ˆä»®ãƒ«ãƒ¼ãƒ«ï¼‰</h3>
        <ul>
          <li>é¡§å®¢åãƒ»å€‹äººåãƒ»ä½æ‰€ãƒ»é›»è©±ãƒ»ãƒ¡ãƒ¼ãƒ«</li>
          <li>å¥‘ç´„/è¦‹ç©ã®é‡‘é¡ã‚„å–å¼•æ¡ä»¶ï¼ˆå›ºæœ‰ã®æ•°å­—ï¼‰</li>
          <li>ç¤¾å†…IDãƒ»ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒ»ç¤¾å†…é™å®šURL</li>
          <li>æœªå…¬é–‹æƒ…å ±ï¼ˆå£²ä¸Š/äººäº‹/æ¡ˆä»¶åï¼‰</li>
        </ul>
        <div class="hint">è¿·ã£ãŸã‚‰å›ºæœ‰åè©ã‚’ã€ŒAç¤¾ã€ã€Œæ‹…å½“è€…Xã€ã«ç½®æ›ã—ã¦ãã ã•ã„ã€‚</div>
      </div>
    </section>

    <section class="grid" aria-label="ãƒ¡ã‚¤ãƒ³">
      <!-- Input -->
      <div class="card" aria-label="å…¥åŠ›">
        <h2>
          å…¥åŠ›
          <span class="badge" id="modeBadge">ãƒ‡ãƒ¢å…¥åŠ›</span>
        </h2>

        <div class="controls" aria-label="å…¥åŠ›ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿ã¨è£œåŠ©">
          <div class="seg" role="tablist" aria-label="å…¥åŠ›ãƒ¢ãƒ¼ãƒ‰">
            <button id="tabDemo" class="active" role="tab" aria-selected="true">ãƒ‡ãƒ¢å…¥åŠ›ã‚’ä½¿ã†</button>
            <button id="tabUser" role="tab" aria-selected="false">è‡ªåˆ†ã§å…¥åŠ›ã™ã‚‹</button>
          </div>

          <button class="btn ghost" id="btnInsertDemo">å…¥åŠ›ä¾‹ã‚’å…¥ã‚Œã‚‹</button>
          <button class="btn" id="btnMask">ãƒã‚¹ã‚­ãƒ³ã‚°ä¾‹ã«ç½®æ›</button>
          <button class="btn" id="btnClear">ã‚¯ãƒªã‚¢</button>
        </div>

        <label for="inputText">éƒ¨ä¸‹ãŒä½œã£ãŸãƒ¡ãƒ¢ãƒ»è³‡æ–™ï¼ˆãã®ã¾ã¾è²¼ã‚Šä»˜ã‘ï¼‰</label>
        <textarea id="inputText" placeholder="ä¾‹ï¼šç®‡æ¡æ›¸ãã®ä¼ç”»ãƒ¡ãƒ¢ã€é€”ä¸­ãƒ¡ãƒ¢ã€æœªæ•´ç†ã®è³‡æ–™ãƒ†ã‚­ã‚¹ãƒˆï¼ˆæ•°å€¤ãŒãªãã¦ã‚‚OKï¼‰"></textarea>
        <div class="small">â€» èª¬æ˜ç”¨ã‚µãƒ³ãƒ—ãƒ«ã¯ã€Œå®Ÿåœ¨ã®æ•°å­—ãƒ»åˆ¤æ–­ã€ã«ä½¿ãˆãªã„å½¢ã«ã—ã¦ã‚ã‚Šã¾ã™ã€‚</div>

        <div class="runrow">
          <button class="btn primary" id="btnRun">è¦ç‚¹ã‚’æ•´ç†ã—ã¦è¦‹ã‚‹</button>
          <div class="disclaimer">
            <strong>å‡ºåŠ›ã¯è¦ç‚¹æ•´ç†ã®ã¿</strong>ã§ã™ï¼ˆææ¡ˆãƒ»çµè«–ã¯è¡Œã„ã¾ã›ã‚“ï¼‰ã€‚<br>
            æƒ…å ±ãŒè¶³ã‚Šãªã„å ´åˆã¯ã€Œè¿½åŠ ã§ç¢ºèªã™ã¹ãç‚¹ã€ã¨ã—ã¦è¿”ã—ã¾ã™ã€‚
          </div>
        </div>

        <div class="divider"></div>

        <div class="small">
          ä½¿ã„æ–¹ã®ç›®å®‰ï¼šâ‘ ã€Œå…¥åŠ›ä¾‹ã‚’å…¥ã‚Œã‚‹ã€â†’â‘¡ã€Œè¦ç‚¹ã‚’æ•´ç†ã—ã¦è¦‹ã‚‹ã€â†’â‘¢ã€Œç¤¾å†…ã§ä½¿ãˆãã†ã‹ã€ã ã‘åˆ¤æ–­
        </div>
      </div>

      <!-- Output -->
      <div class="card" aria-label="å‡ºåŠ›">
        <h2>
          å‡ºåŠ›
          <span class="badge demo" id="demoTag" style="display:none;">ğŸ§ª ãƒ‡ãƒ¢å‡ºåŠ›</span>
        </h2>

        <div id="outputArea">
          <div class="empty">
            ã¾ã å‡ºåŠ›ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚<br>
            ã€Œå…¥åŠ›ä¾‹ã‚’å…¥ã‚Œã‚‹ã€â†’ã€Œè¦ç‚¹ã‚’æ•´ç†ã—ã¦è¦‹ã‚‹ã€ã‚’è©¦ã—ã¦ãã ã•ã„ã€‚
          </div>
        </div>

        <div class="decision" aria-label="ä½“é¨“å¾Œã®åˆ¤æ–­">
          <div class="judge">
            <h4>ç¤¾å†…ã§ä½¿ãˆãã†</h4>
            <p>ä»®ãƒ«ãƒ¼ãƒ«ãƒ»å‡ºåŠ›ã®çŸ­ã•ãƒ»è²¬ä»»åˆ†ç•ŒãŒã€ç¾å ´é‹ç”¨ã§ã‚‚å®ˆã‚Œãã†ã€‚</p>
            <button class="ok" id="btnJudgeOk">ã“ã®ç¯„å›²ãªã‚‰ä½¿ã‚ã›ã¦ã„ã„</button>
          </div>
          <div class="judge">
            <h4>ã¾ã æ—©ã„ï¼ˆãƒ«ãƒ¼ãƒ«æœªæ•´å‚™ï¼‰</h4>
            <p>ç¦æ­¢æƒ…å ±ãƒ»ãƒ¬ãƒ“ãƒ¥ãƒ¼æ‹…å½“ãƒ»åˆ©ç”¨ç¯„å›²ãŒæ±ºã¾ã£ã¦ãŠã‚‰ãšã€äº‹æ•…ã‚Šãã†ã€‚</p>
            <button class="hold" id="btnJudgeHold">ã„ã£ãŸã‚“ä¿ç•™ã«ã™ã‚‹</button>
          </div>
        </div>

        <div class="foot">
          ã“ã®ãƒšãƒ¼ã‚¸ã¯ãƒ‡ãƒ¢ã§ã™ã€‚å…¥åŠ›å†…å®¹ã¯é€ä¿¡ãƒ»ä¿å­˜ã•ã‚Œã¾ã›ã‚“ï¼ˆãƒ–ãƒ©ã‚¦ã‚¶å†…ã®ã¿ã§å‹•ä½œï¼‰ã€‚<br>
          GitHub Pageså…¬é–‹æ™‚ã‚‚åŒæ§˜ã«ã€å¤–éƒ¨é€£æºã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
        </div>
      </div>
    </section>
  </div>

  <div class="toast" id="toast" role="status" aria-live="polite"></div>

  <script>
    // ----------------------------
    // Demo inputs (safe)
    // ----------------------------
    const DEMO_1 = `ãƒ»æ–°æ–½ç­–ã®æ¤œè¨ãƒ¡ãƒ¢
ãƒ»æƒ³å®šã‚³ã‚¹ãƒˆï¼šæ•°åä¸‡å††è¦æ¨¡ï¼ˆæ­£ç¢ºãªé‡‘é¡ã¯æœªç¢ºå®šï¼‰
ãƒ»å¯¾è±¡ï¼šæ—¢å­˜é¡§å®¢ï¼‹æ–°è¦
ãƒ»å®Ÿæ–½ã‚¿ã‚¤ãƒŸãƒ³ã‚°ï¼šæ¥æœŸå‰åŠã‚’æƒ³å®šï¼ˆç¢ºå®šã§ã¯ãªã„ï¼‰
ãƒ»æˆæœæŒ‡æ¨™ï¼šåå¿œç‡ã‚’è¦‹ãŸã„ãŒåŸºæº–æœªå®š
ãƒ»æ‡¸å¿µï¼šéå»æ–½ç­–ã¨ã®å·®ãŒæ›–æ˜§ã€æ‹…å½“é–“ã§å‰æãŒã‚ºãƒ¬ã¦ã„ã‚‹
ãƒ»ã‚„ã‚ŠãŸã„ã“ã¨ï¼šã¾ãšè«–ç‚¹ã‚’æ•´ç†ã—ã¦ã€åˆ¤æ–­ã«å¿…è¦ãªæƒ…å ±ã‚’æƒãˆãŸã„`;

    const DEMO_2 = `ä»Šå›ã®æ–½ç­–ã¯èªçŸ¥æ‹¡å¤§ã‚’ç›®çš„ã¨ã—ãŸã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³ã§ã™ã€‚
SNSã‚’ä¸­å¿ƒã«å±•é–‹ã—ã€ãƒ–ãƒ©ãƒ³ãƒ‰ã‚¤ãƒ¡ãƒ¼ã‚¸ã®å‘ä¸Šã‚’ç‹™ã„ã¾ã™ã€‚
ç«¶åˆã‚‚åŒæ§˜ã®æ–½ç­–ã‚’è¡Œã£ã¦ã„ã‚‹ãŸã‚ã€å·®åˆ¥åŒ–ãŒé‡è¦ã§ã™ã€‚
è©³ç´°ãªæ•°å€¤è¨­è¨ˆã‚„ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã¯ä»Šå¾Œè©°ã‚ã¦ã„ãã¾ã™ã€‚`;

    // ----------------------------
    // Simple UI state
    // ----------------------------
    let mode = "demo"; // demo | user
    let demoIndex = 0; // 0 or 1
    const el = (id) => document.getElementById(id);

    const inputText = el("inputText");
    const outputArea = el("outputArea");
    const toast = el("toast");
    const demoTag = el("demoTag");
    const modeBadge = el("modeBadge");

    const tabDemo = el("tabDemo");
    const tabUser = el("tabUser");

    function showToast(msg){
      toast.textContent = msg;
      toast.classList.add("show");
      setTimeout(()=> toast.classList.remove("show"), 1600);
    }

    function setMode(next){
      mode = next;
      const isDemo = mode === "demo";
      tabDemo.classList.toggle("active", isDemo);
      tabUser.classList.toggle("active", !isDemo);
      tabDemo.setAttribute("aria-selected", isDemo ? "true" : "false");
      tabUser.setAttribute("aria-selected", !isDemo ? "true" : "false");
      modeBadge.textContent = isDemo ? "ãƒ‡ãƒ¢å…¥åŠ›" : "è‡ªåˆ†ã§å…¥åŠ›";
      demoTag.style.display = "none";
      if (isDemo && inputText.value.trim().length === 0){
        insertDemo();
      }
    }

    function insertDemo(){
      // alternate between two demo styles
      demoIndex = (demoIndex + 1) % 2;
      inputText.value = (demoIndex === 0) ? DEMO_1 : DEMO_2;
      showToast("å…¥åŠ›ä¾‹ã‚’ã‚»ãƒƒãƒˆã—ã¾ã—ãŸ");
    }

    function clearAll(){
      inputText.value = "";
      outputArea.innerHTML = `<div class="empty">
        ã¾ã å‡ºåŠ›ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚<br>
        ã€Œå…¥åŠ›ä¾‹ã‚’å…¥ã‚Œã‚‹ã€â†’ã€Œè¦ç‚¹ã‚’æ•´ç†ã—ã¦è¦‹ã‚‹ã€ã‚’è©¦ã—ã¦ãã ã•ã„ã€‚
      </div>`;
      demoTag.style.display = "none";
      showToast("ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ");
    }

    // Very lightweight "masking" helper (demo-purpose)
    function maskText(s){
      // Replace likely personal identifiers / emails / phone-like patterns
      let t = s;
      t = t.replace(/[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}/gi, "ï¼ˆãƒ¡ãƒ¼ãƒ«ï¼‰");
      t = t.replace(/0\d{1,4}-\d{1,4}-\d{3,4}/g, "ï¼ˆé›»è©±ï¼‰");
      t = t.replace(/\b\d{2,4}\/\d{1,2}\/\d{1,2}\b/g, "ï¼ˆæ—¥ä»˜ï¼‰");
      // Replace obvious company/person markers (heuristic)
      t = t.replace(/æ ªå¼ä¼šç¤¾[^\sã€ã€‚]{1,12}/g, "Aç¤¾");
      t = t.replace(/æœ‰é™ä¼šç¤¾[^\sã€ã€‚]{1,12}/g, "Aç¤¾");
      t = t.replace(/[ä¸€-é¾ ã€…ã€†ãƒµãƒ¶]{2,4}\s?[ä¸€-é¾ ã€…ã€†ãƒµãƒ¶]{1,4}ã•ã‚“/g, "æ‹…å½“è€…Xã•ã‚“");
      return t;
    }

    // ----------------------------
    // Core: "judgement-first structuring"
    // (No external calls. Deterministic-ish heuristic.)
    // ----------------------------
    function analyze(text){
      const raw = text.trim();
      const lines = raw
        .split(/\n+/)
        .map(s=>s.trim())
        .filter(Boolean);

      // classify hints
      const keywordsUndecided = ["æœªå®š","æœªç¢ºå®š","æ¤œè¨","ä»Šå¾Œ","è©°ã‚ã‚‹","è¦æ•´ç†","å·®åˆ¥åŒ–","åŸºæº–æœªå®š","æƒ³å®š","ç†æƒ³","ç¢ºå®šã§ã¯ãªã„"];
      const keywordsRisk = ["æ‡¸å¿µ","ãƒªã‚¹ã‚¯","ç‚ä¸Š","ã‚¯ãƒ¬ãƒ¼ãƒ ","ã‚ºãƒ¬","èª¤è§£","æ³•å‹™","æƒ…ã‚·ã‚¹","å¥‘ç´„","å€‹äººæƒ…å ±","æ¼ãˆã„","æœªå…¬é–‹"];
      const keywordsNeed = ["å¿…è¦","æƒãˆã‚‹","ç¢ºèª","æ±ºã‚ã‚‹","åˆ¤æ–­","å‰æ","ç›®çš„","å¯¾è±¡","æœŸé–“","äºˆç®—","æŒ‡æ¨™","KPI"];

      const found = {
        undecided: [],
        risk: [],
        need: []
      };

      const scoreLine = (l, arr) => arr.some(k => l.includes(k));

      for (const l of lines){
        if (scoreLine(l, keywordsUndecided)) found.undecided.push(l);
        if (scoreLine(l, keywordsRisk)) found.risk.push(l);
        if (scoreLine(l, keywordsNeed)) found.need.push(l);
      }

      // Build "facts / assumptions / missing"
      // Facts: lines that look like declared items (ãƒ» / - / number)
      const facts = lines.filter(l => /^([ãƒ»\-]|(\d+[\.\)]))/.test(l)).slice(0, 4);
      const undec = found.undecided.slice(0, 4);
      const missing = [];

      // Missing prompts based on absence cues
      const joined = raw;
      const hasTarget = /å¯¾è±¡|ã‚¿ãƒ¼ã‚²ãƒƒãƒˆ/.test(joined);
      const hasTiming = /æ™‚æœŸ|æœŸé–“|ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«|æ¥æœˆ|æ¥æœŸ|ã„ã¤/.test(joined);
      const hasMetric = /æŒ‡æ¨™|KPI|æˆæœ|åå¿œç‡|CV|CTR|å¿œå‹Ÿ|å£²ä¸Š/.test(joined);
      const hasScope = /ç¯„å›²|å¯¾è±¡å¤–|å„ªå…ˆ|ã‚„ã‚‰ãªã„/.test(joined);
      const hasOwner = /æ‹…å½“|è²¬ä»»|ã‚ªãƒ¼ãƒŠãƒ¼|èª°ãŒ/.test(joined);

      if (!hasTarget) missing.push("å¯¾è±¡ï¼ˆèª°ã«å‘ã‘ã‚‹/ã©ã®ç¯„å›²ã«å½±éŸ¿ã™ã‚‹ã‹ï¼‰ãŒä¸æ˜");
      if (!hasTiming) missing.push("å®Ÿæ–½ã‚¿ã‚¤ãƒŸãƒ³ã‚°ï¼ˆã„ã¤åˆ¤æ–­ãŒå¿…è¦ã‹ï¼‰ãŒä¸æ˜");
      if (!hasMetric) missing.push("æˆæœæŒ‡æ¨™ï¼ˆä½•ã‚’è¦‹ã¦æˆåŠŸ/å¤±æ•—ã¨ã™ã‚‹ã‹ï¼‰ãŒä¸æ˜");
      if (!hasScope) missing.push("ã‚¹ã‚³ãƒ¼ãƒ—ï¼ˆã‚„ã‚‹/ã‚„ã‚‰ãªã„ãƒ»å„ªå…ˆé †ä½ï¼‰ãŒä¸æ˜");
      if (!hasOwner) missing.push("è²¬ä»»è€…/ç¢ºèªè€…ï¼ˆèª°ãŒæœ€çµ‚ç¢ºèªã™ã‚‹ã‹ï¼‰ãŒä¸æ˜");

      // Decision points: turn ambiguous items into yes/no questions
      const decisionPoints = [];
      // heuristic patterns
      if (/æ—¢å­˜|æ–°è¦/.test(joined)) decisionPoints.push("å¯¾è±¡ã‚’ã€Œæ—¢å­˜ä¸­å¿ƒã€ã‹ã€Œæ–°è¦ä¸­å¿ƒã€ã‹ã€ã©ã¡ã‚‰ã«å¯„ã›ã‚‹ã‹");
      if (/èªçŸ¥|ãƒ–ãƒ©ãƒ³ãƒ‰/.test(joined)) decisionPoints.push("ç›®çš„ã‚’ã€ŒèªçŸ¥ã€å„ªå…ˆã‹ã€Œç²å¾—ã€å„ªå…ˆã‹ã€ã©ã¡ã‚‰ã§è©•ä¾¡ã™ã‚‹ã‹");
      if (/äºˆç®—|ã‚³ã‚¹ãƒˆ|æ•°åä¸‡|ä¸‡å††/.test(joined)) decisionPoints.push("è²»ç”¨ä¸Šé™ï¼ˆã–ã£ãã‚Šä¸Šé™ãƒ¬ãƒ³ã‚¸ï¼‰ã‚’å…ˆã«æ±ºã‚ã‚‹ã‹");
      if (/SNS|åºƒå‘Š/.test(joined)) decisionPoints.push("ãƒãƒ£ãƒãƒ«ã‚’ã€ŒSNSã®ã¿ã€ã‹ã€Œä»–ãƒãƒ£ãƒãƒ«ä½µç”¨ã€ã‹");
      if (/å·®åˆ¥åŒ–|ç«¶åˆ/.test(joined)) decisionPoints.push("å·®åˆ¥åŒ–è¦ç´ ã‚’ã€Œè¨€è‘‰ã€ã‹ã€Œã‚ªãƒ•ã‚¡ãƒ¼ã€ã‹ã€Œä½“é¨“ã€ã©ã“ã§ä½œã‚‹ã‹");

      // Risks / caution points (keep short & safe)
      const cautions = [];
      if (found.risk.length) cautions.push("æ‡¸å¿µç‚¹ãŒåˆ—æŒ™ã•ã‚Œã¦ã„ã‚‹ãŒã€å„ªå…ˆé †ä½ãŒæœªè¨­å®šï¼ˆã©ã‚ŒãŒæœ€é‡è¦ã‹ä¸æ˜ï¼‰");
      if (!/æ ¹æ‹ |ãƒ‡ãƒ¼ã‚¿|éå»|å®Ÿç¸¾/.test(joined)) cautions.push("æ ¹æ‹ ï¼ˆéå»æ–½ç­–ã®çµæœ/æ¯”è¼ƒï¼‰ãŒä¸è¶³ã—ã¦ãŠã‚Šã€åˆ¤æ–­ãŒæ„Ÿè¦šã«å¯„ã‚Šã‚„ã™ã„");
      if (/æ•°åä¸‡|ä¸‡å††|å£²ä¸Š|äººäº‹|æ¡ˆä»¶/.test(joined)) cautions.push("å›ºæœ‰ã®æ•°å€¤ãƒ»æœªå…¬é–‹æƒ…å ±ã¯å…¥åŠ›ã—ãªã„é‹ç”¨ãŒå¿…è¦ï¼ˆãƒã‚¹ã‚­ãƒ³ã‚°å‰æï¼‰");
      cautions.push("å‡ºåŠ›ã¯è¦ç‚¹æ•´ç†ã®ã¿ã€‚æœ€çµ‚åˆ¤æ–­ãƒ»å¯¾å¤–ç™ºä¿¡ã¯äººãŒè²¬ä»»ã‚’æŒã¤å‰æ");

      // Prepare output blocks (max 6 bullets each)
      const block1 = [];
      if (facts.length) block1.push(`å‰æï¼ˆæ›¸ã‹ã‚Œã¦ã„ã‚‹ã“ã¨ï¼‰ï¼š${facts.map(s=>s.replace(/^([ãƒ»\-]\s*)/,"")).join(" / ")}`);
      if (undec.length) block1.push(`æœªç¢ºå®šï¼ˆåˆ¤æ–­å‰ã«åŸ‹ã‚ãŸã„ï¼‰ï¼š${undec.map(s=>s.replace(/^([ãƒ»\-]\s*)/,"")).join(" / ")}`);
      if (missing.length) block1.push(`è¿½åŠ ã§ç¢ºèªãŒå¿…è¦ï¼š${missing.slice(0,3).join(" / ")}`);

      const block2 = (decisionPoints.length ? decisionPoints : [
        "ç›®çš„ï¼ˆä½•ã‚’é”æˆã—ãŸã„ã‹ï¼‰ã‚’ä¸€è¨€ã§å›ºå®šã™ã‚‹",
        "å¯¾è±¡ï¼ˆèª°ã«å½±éŸ¿ã™ã‚‹ã‹ï¼‰ã‚’é™å®šã™ã‚‹",
        "æˆåŠŸã®åˆ¤æ–­åŸºæº–ï¼ˆä½•ã‚’è¦‹ã¦è‰¯ã—æ‚ªã—ã‚’æ±ºã‚ã‚‹ã‹ï¼‰ã‚’æ±ºã‚ã‚‹"
      ]).slice(0,5);

      const block3 = cautions.slice(0,5);

      return { block1, block2, block3 };
    }

    function renderOutput({block1, block2, block3}, isDemo){
      demoTag.style.display = isDemo ? "inline-flex" : "none";

      const html = `
        <div class="outcard">
          <h3>â‘  ã¾ãšæŠŠæ¡ã™ã¹ãå‰æ <span class="tag">èª­ã‚€å‰ã«ã“ã“ã ã‘</span></h3>
          <ul>${(block1.length ? block1 : ["å…¥åŠ›å†…å®¹ãŒçŸ­ã™ãã¾ã™ã€‚ç®‡æ¡æ›¸ãã§3ã€œ5è¡Œã»ã©è¿½åŠ ã—ã¦ãã ã•ã„ã€‚"]).map(li=>`<li>${escapeHtml(li)}</li>`).join("")}</ul>
        </div>
        <div style="height:10px"></div>
        <div class="outcard">
          <h3>â‘¡ åˆ¤æ–­å‰ã«è¦‹ã‚‹ã¹ããƒã‚¤ãƒ³ãƒˆ <span class="tag">Yes/Noã®åˆ†å²</span></h3>
          <ul>${block2.map(li=>`<li>${escapeHtml(li)}</li>`).join("")}</ul>
        </div>
        <div style="height:10px"></div>
        <div class="outcard">
          <h3>â‘¢ å¿µã®ãŸã‚æ³¨æ„ã—ãŸã„ç‚¹ <span class="tag">äº‹æ•…é˜²æ­¢</span></h3>
          <ul>${block3.map(li=>`<li>${escapeHtml(li)}</li>`).join("")}</ul>
        </div>
      `;
      outputArea.innerHTML = html;
    }

    function escapeHtml(s){
      return s
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    // ----------------------------
    // Events
    // ----------------------------
    tabDemo.addEventListener("click", ()=> setMode("demo"));
    tabUser.addEventListener("click", ()=> setMode("user"));

    el("btnInsertDemo").addEventListener("click", ()=>{
      setMode("demo");
      insertDemo();
    });

    el("btnMask").addEventListener("click", ()=>{
      const before = inputText.value;
      if (!before.trim()){
        showToast("å…¥åŠ›ãŒç©ºã§ã™");
        return;
      }
      inputText.value = maskText(before);
      showToast("ãƒã‚¹ã‚­ãƒ³ã‚°ä¾‹ã«ç½®æ›ã—ã¾ã—ãŸ");
    });

    el("btnClear").addEventListener("click", clearAll);

    el("btnRun").addEventListener("click", ()=>{
      const t = inputText.value.trim();
      if (!t){
        showToast("ã¾ãšå…¥åŠ›ã—ã¦ãã ã•ã„");
        return;
      }
      const isDemo = (mode === "demo");
      const result = analyze(t);
      renderOutput(result, isDemo);
      showToast("è¦ç‚¹ã‚’æ•´ç†ã—ã¾ã—ãŸ");
    });

    el("btnJudgeOk").addEventListener("click", ()=>{
      showToast("åˆ¤æ–­ï¼šã“ã®ç¯„å›²ãªã‚‰ä½¿ã‚ã›ã¦ã„ã„");
    });
    el("btnJudgeHold").addEventListener("click", ()=>{
      showToast("åˆ¤æ–­ï¼šã„ã£ãŸã‚“ä¿ç•™ï¼ˆãƒ«ãƒ¼ãƒ«æœªæ•´å‚™ï¼‰");
    });

    // Init: start with demo filled
    setMode("demo");
    insertDemo();
  </script>
</body>
</html>
