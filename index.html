<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>åˆ¤æ–­ã‚’æ—©ã‚ã‚‹æ•´ç†ãƒ‡ãƒ¢ï¼ˆç¬¬3å·ï¼‰</title>
  <meta name="description" content="éƒ¨ä¸‹ã®ãƒ¡ãƒ¢ã‚„è³‡æ–™ã‚’ã€åˆ¤æ–­ã«å¿…è¦ãªãƒã‚¤ãƒ³ãƒˆã ã‘ã«æ•´ç†ã™ã‚‹ä½“æ„Ÿãƒ‡ãƒ¢ã€‚ç¤¾å†…ã§ä½¿ã‚ã›ã¦è‰¯ã„ã‹ã‚’3åˆ†ã§åˆ¤æ–­ã€‚" />
  <style>
    :root{
      --bg:#ffffff;
      --panel:#f7f8fa;
      --text:#111827;
      --muted:#6b7280;
      --line:#e5e7eb;
      --accent:#2563eb;
      --shadow: 0 10px 28px rgba(0,0,0,.06);
      --radius: 16px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI",
        Roboto, "Noto Sans JP", "Hiragino Sans", "Yu Gothic", "Meiryo", Arial, sans-serif;
      color:var(--text);
      background:linear-gradient(180deg,#fff 0%, #fafafa 100%);
    }
    .wrap{max-width:940px;margin:0 auto;padding:14px 12px 32px}
    .top{
      padding:14px 12px;
      border:1px solid var(--line);
      border-radius:var(--radius);
      background:#fff;
      box-shadow:var(--shadow);
    }
    .title{font-size:18px;font-weight:900;letter-spacing:.2px}
    .subtitle{margin-top:6px;font-size:13px;color:var(--muted);line-height:1.45}
    .chips{margin-top:10px;display:flex;gap:8px;flex-wrap:wrap}
    .chip{font-size:12px;background:#eef2ff;border:1px solid #e0e7ff;padding:6px 10px;border-radius:999px}

    .grid{margin-top:12px;display:grid;grid-template-columns:1fr;gap:12px}
    @media (min-width: 900px){ .grid{grid-template-columns: 1.05fr .95fr} }

    .card{
      background:#fff;
      border:1px solid var(--line);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:12px;
    }
    .card h2{margin:0 0 10px 0;font-size:14px;display:flex;justify-content:space-between;align-items:center}
    .badge{font-size:11px;color:#0f172a;background:#f1f5f9;border:1px solid #e2e8f0;padding:4px 8px;border-radius:999px}
    .badge.demo{background:#ecfeff;border-color:#cffafe;color:#155e75}

    details{
      border:1px solid var(--line);
      border-radius:14px;
      background:var(--panel);
      padding:10px 10px;
      margin:10px 0 0;
    }
    summary{
      cursor:pointer;
      font-size:13px;
      font-weight:900;
      list-style:none;
    }
    summary::-webkit-details-marker{display:none}
    .rule{
      margin-top:8px;
      font-size:13px;
      color:#7c2d12;
      line-height:1.5;
      padding-left:16px;
    }
    .rule li{margin:4px 0}
    .rulehint{margin-top:8px;font-size:12px;color:#92400e;line-height:1.45}

    .controls{
      display:flex;flex-wrap:wrap;gap:8px;align-items:center;margin-bottom:10px
    }
    .seg{
      display:flex;border:1px solid var(--line);border-radius:999px;overflow:hidden;background:#fff
    }
    .seg button{
      border:0;background:transparent;padding:8px 10px;font-size:12px;color:#0f172a;cursor:pointer
    }
    .seg button.active{background:#e0e7ff;color:#1e3a8a;font-weight:900}
    .btn{
      border:1px solid var(--line);background:#fff;padding:8px 10px;border-radius:12px;
      font-size:12px;cursor:pointer
    }
    .btn.primary{
      border-color:#1d4ed8;
      background:linear-gradient(180deg,#2563eb 0%, #1d4ed8 100%);
      color:#fff;font-weight:900;
      padding:11px 12px;
    }

    label{display:block;font-size:12px;font-weight:900;margin-bottom:6px}
    textarea{
      width:100%;
      min-height:190px;
      border:1px solid var(--line);
      border-radius:14px;
      padding:12px;
      font-size:16px; /* iOSã®è‡ªå‹•æ‹¡å¤§ã‚’é¿ã‘ã‚‹ */
      line-height:1.5;
      resize:vertical;
      outline:none;
      background:#fff;
    }
    textarea:focus{border-color:#93c5fd; box-shadow:0 0 0 4px rgba(147,197,253,.25)}
    .hint{margin-top:6px;font-size:12px;color:var(--muted);line-height:1.45}

    .stickybar{
      position:sticky; bottom:10px;
      background:rgba(255,255,255,.92);
      backdrop-filter: blur(8px);
      border:1px solid var(--line);
      border-radius:14px;
      padding:10px;
      box-shadow: 0 8px 22px rgba(0,0,0,.06);
      display:flex; gap:10px; align-items:center; justify-content:space-between;
      margin-top:10px;
    }
    .stickybar .sub{font-size:12px;color:var(--muted);line-height:1.35}
    .stickybar .sub strong{color:var(--text)}

    .outcard{
      background:var(--panel);
      border:1px solid var(--line);
      border-radius:14px;
      padding:12px;
      margin-bottom:10px;
    }
    .outcard h3{margin:0 0 6px 0;font-size:13px;display:flex;justify-content:space-between;align-items:center;gap:8px}
    .tag{font-size:11px;padding:3px 8px;border-radius:999px;border:1px solid #e2e8f0;background:#fff;color:#334155;white-space:nowrap}
    .outcard ul{margin:0;padding-left:18px;font-size:13px;line-height:1.55}
    .empty{
      font-size:13px;color:var(--muted);line-height:1.6;
      padding:12px;border:1px dashed #d1d5db;border-radius:14px;background:#fff;
    }

    .judgebox{
      border:1px solid var(--line);
      border-radius:14px;
      padding:10px;
      background:#fff;
      font-size:12px;
      color:var(--muted);
      line-height:1.45;
      margin-top:10px;
    }
    .judgebox strong{color:var(--text)}

    .toast{
      position:fixed; left:50%; bottom:16px; transform:translateX(-50%);
      background:#111827; color:#fff; font-size:13px;
      padding:10px 12px; border-radius:12px;
      box-shadow:0 10px 24px rgba(0,0,0,.18);
      opacity:0; pointer-events:none;
      transition:opacity .18s ease, transform .18s ease;
    }
    .toast.show{opacity:1; transform:translateX(-50%) translateY(-4px)}
    .foot{
      margin-top:12px; font-size:12px; color:var(--muted); line-height:1.5;
      text-align:center;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <section class="top" aria-label="ãƒ˜ãƒƒãƒ€ãƒ¼">
      <div class="title">åˆ¤æ–­ã‚’æ—©ã‚ã‚‹æ•´ç†ãƒ‡ãƒ¢</div>
      <div class="subtitle">
        éƒ¨ä¸‹ã®ãƒ¡ãƒ¢ã‚„è³‡æ–™ã‚’ã€Œãã®ã¾ã¾èª­ã¾ãšã«ã€ã€åˆ¤æ–­ã«å¿…è¦ãªãƒã‚¤ãƒ³ãƒˆã ã‘æŠŠæ¡ã§ãã¾ã™ã€‚<br>
        â€» ã“ã‚Œã¯è¦ç‚¹æ•´ç†ã®ä½“æ„Ÿãƒ‡ãƒ¢ã§ã™ï¼ˆæœ€çµ‚åˆ¤æ–­ã¯äººãŒè¡Œã†å‰æï¼‰ã€‚
      </div>
      <div class="chips" aria-label="è©•ä¾¡è»¸">
        <div class="chip">åˆ¤æ–­ãŒé€Ÿããªã‚‹ã‹</div>
        <div class="chip">äº‹æ•…ã‚‰ãªãã†ã‹</div>
        <div class="chip">éƒ¨ä¸‹ã«ä»»ã›ã‚‰ã‚Œã‚‹ã‹</div>
      </div>

      <details>
        <summary>âš ï¸ å…¥åŠ›ã—ãªã„ã§ãã ã•ã„ï¼ˆä»®ãƒ«ãƒ¼ãƒ«ï¼‰</summary>
        <ul class="rule">
          <li>é¡§å®¢åãƒ»å€‹äººåãƒ»ä½æ‰€ãƒ»é›»è©±ãƒ»ãƒ¡ãƒ¼ãƒ«</li>
          <li>å¥‘ç´„/è¦‹ç©ã®é‡‘é¡ã‚„å–å¼•æ¡ä»¶ï¼ˆå›ºæœ‰ã®æ•°å­—ï¼‰</li>
          <li>ç¤¾å†…IDãƒ»ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒ»ç¤¾å†…é™å®šURL</li>
          <li>æœªå…¬é–‹æƒ…å ±ï¼ˆå£²ä¸Š/äººäº‹/æ¡ˆä»¶åï¼‰</li>
        </ul>
        <div class="rulehint">
          è¿·ã£ãŸã‚‰å›ºæœ‰åè©ã‚’ã€ŒAç¤¾ã€ã€Œæ‹…å½“è€…Xã€ã«ç½®æ›ã—ã¦ãã ã•ã„ã€‚<br>
          â€» ã“ã®ãƒ‡ãƒ¢ã®å…¥åŠ›ä¾‹ã¯èª¬æ˜ç”¨ã§ã€å®Ÿåœ¨ã®åˆ¤æ–­ã«ä½¿ãˆãªã„å½¢ã«ã—ã¦ã‚ã‚Šã¾ã™ã€‚
        </div>
      </details>
    </section>

    <section class="grid" aria-label="ãƒ¡ã‚¤ãƒ³">
      <!-- Input -->
      <div class="card" aria-label="å…¥åŠ›">
        <h2>å…¥åŠ› <span class="badge" id="modeBadge">ãƒ‡ãƒ¢å…¥åŠ›</span></h2>

        <div class="controls" aria-label="å…¥åŠ›ãƒ¢ãƒ¼ãƒ‰ã¨è£œåŠ©">
          <div class="seg" role="tablist" aria-label="å…¥åŠ›ãƒ¢ãƒ¼ãƒ‰">
            <button id="tabDemo" class="active" role="tab" aria-selected="true">ãƒ‡ãƒ¢</button>
            <button id="tabUser" role="tab" aria-selected="false">è‡ªåˆ†ã§</button>
          </div>
          <button class="btn" id="btnInsertDemo">å…¥åŠ›ä¾‹</button>
          <button class="btn" id="btnClear">ã‚¯ãƒªã‚¢</button>
          <button class="btn" id="btnVoice" style="display:none;">éŸ³å£°å…¥åŠ›ï¼ˆÎ²ï¼‰</button>
        </div>

        <label for="inputText">ãƒ¡ãƒ¢ãƒ»è³‡æ–™ï¼ˆãã®ã¾ã¾è²¼ã‚Šä»˜ã‘ï¼‰</label>
        <textarea id="inputText" placeholder="ï¼ˆãƒ‡ãƒ¢ï¼‰å…¥åŠ›ä¾‹ãŒå…¥ã‚Šã¾ã™ã€‚å¿…è¦ãªã‚‰å†…å®¹ã‚’æ›¸ãæ›ãˆã¦ãã ã•ã„ã€‚"></textarea>
        <div class="hint">ãƒã‚¤ãƒ³ãƒˆï¼šå‡ºåŠ›ã¯ã€Œè¦ç‚¹æ•´ç†ã®ã¿ã€ã€‚ææ¡ˆãƒ»çµè«–ã¯å‡ºã—ã¾ã›ã‚“ã€‚ä¸è¶³ã¯ã€Œè¿½åŠ ã§ç¢ºèªã€ã«å›ã—ã¾ã™ã€‚</div>

        <div class="stickybar" aria-label="å®Ÿè¡Œãƒãƒ¼">
          <button class="btn primary" id="btnRun">è¦ç‚¹ã‚’æ•´ç†ã—ã¦è¦‹ã‚‹</button>
          <div class="sub"><strong>ææ¡ˆãƒ»çµè«–ã¯å‡ºã—ã¾ã›ã‚“ã€‚</strong><br>ä¸è¶³ã¯ã€Œè¿½åŠ ã§ç¢ºèªã€ã«å›ã—ã¾ã™ã€‚</div>
        </div>
      </div>

      <!-- Output -->
      <div class="card" aria-label="å‡ºåŠ›">
        <h2>å‡ºåŠ› <span class="badge demo" id="demoTag" style="display:none;">ğŸ§ª ãƒ‡ãƒ¢å‡ºåŠ›</span></h2>

        <div id="outputArea">
          <div class="empty">ã€Œå…¥åŠ›ä¾‹ã€â†’ã€Œè¦ç‚¹ã‚’æ•´ç†ã—ã¦è¦‹ã‚‹ã€ã‚’è©¦ã—ã¦ãã ã•ã„ã€‚</div>
        </div>

        <div class="judgebox">
          <strong>ç¤¾å†…åˆ¤æ–­ã®è¦³ç‚¹ï¼ˆ3ã¤ã ã‘ï¼‰</strong><br>
          â‘  ç¦æ­¢å…¥åŠ›ã‚’å®ˆã‚Œã‚‹é‹ç”¨ã«ã§ãã‚‹ã‹<br>
          â‘¡ å‡ºåŠ›ã‚’â€œä¸‹æ›¸ãâ€ã¨ã—ã¦ãƒ¬ãƒ“ãƒ¥ãƒ¼ã§ãã‚‹ã‹<br>
          â‘¢ éƒ¨ä¸‹ã«ä»»ã›ã¦ã‚‚åˆ¤æ–­ãŒé€Ÿããªã‚‹ã‹
        </div>

        <div class="foot">
          ã“ã®ãƒšãƒ¼ã‚¸ã¯ãƒ‡ãƒ¢ã§ã™ã€‚å…¥åŠ›å†…å®¹ã¯é€ä¿¡ãƒ»ä¿å­˜ã•ã‚Œã¾ã›ã‚“ï¼ˆãƒ–ãƒ©ã‚¦ã‚¶å†…ã®ã¿ã§å‹•ä½œï¼‰ã€‚<br>
          å¤–éƒ¨é€£æºï¼ˆSlack/ä¿å­˜/è‡ªå‹•åŒ–ï¼‰ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
        </div>
      </div>
    </section>
  </div>

  <div class="toast" id="toast" role="status" aria-live="polite"></div>

  <script>
    // ----------------------------
    // Demo inputs (safe but "busy" + numbers)
    // â€» æ•°å­—ã¯å…¥ã‚Œã‚‹ãŒã€æ„æ€æ±ºå®šã§ãã‚‹å›ºæœ‰å®Ÿæ•°ã¯é¿ã‘ã‚‹ï¼ˆãƒ¬ãƒ³ã‚¸/æ¯”ç‡/å›æ•°ãªã©ï¼‰
    // ----------------------------
    const DEMO_1 = `ã€éƒ¨ä¸‹ãƒ¡ãƒ¢ï¼ˆé›‘ï¼‰ã€‘
ãƒ»æ–°æ–½ç­–ã®æ¤œè¨ï¼ˆç›®çš„ãŒã¾ã æ›–æ˜§ï¼‰
ãƒ»å¯¾è±¡ï¼šæ—¢å­˜ï¼‹æ–°è¦ï¼ˆå„ªå…ˆé †ä½æœªå®šï¼‰
ãƒ»æƒ³å®šã‚³ã‚¹ãƒˆï¼šæœˆ 20ã€œ80ä¸‡å††ãƒ¬ãƒ³ã‚¸ï¼ˆè¦‹ç©æœªå–å¾—ï¼‰
ãƒ»æ™‚æœŸï¼šæ¥æœŸå‰åŠã‚’æƒ³å®šï¼ˆç¢ºå®šã§ã¯ãªã„ï¼‰
ãƒ»æŒ‡æ¨™ï¼šåå¿œç‡ã‚’è¦‹ãŸã„ãŒã€åŸºæº–æœªå®š
ãƒ»æ‡¸å¿µï¼šéå»æ–½ç­–ã¨ã®å·®ãŒæ›–æ˜§ï¼æ‹…å½“é–“ã§å‰æãŒã‚ºãƒ¬ã¦ã„ã‚‹
ãƒ»åˆ¤æ–­ã—ãŸã„ï¼šã¾ãšè«–ç‚¹ã‚’æ•´ç†ã—ã¦ã€å¿…è¦æƒ…å ±ã‚’æƒãˆãŸã„`;

    const DEMO_2 = `ã€ç¨Ÿè­°ãƒ¡ãƒ¢ï¼ˆä¸‹æ›¸ãï¼‰ã€‘
ãƒ»ç›®çš„ï¼šæ—¢å­˜é¡§å®¢ã®é›¢è„±ã‚’æ¸›ã‚‰ã—ãŸã„ï¼ˆã©ã®å±¤ãŒé›¢è„±ã—ã¦ã„ã‚‹ã‹æœªæ•´ç†ï¼‰
ãƒ»æ¡ˆï¼šãƒ•ã‚©ãƒ­ãƒ¼æ–½ç­–ï¼ˆãƒ¡ãƒ¼ãƒ«/LINE/åŒæ¢±ç‰©ï¼‰ã‚’ã‚„ã‚ŠãŸã„
ãƒ»ç¾çŠ¶ï¼šå•ã„åˆã‚ã›ãŒæœˆã«æ•°åä»¶ï¼å¯¾å¿œãŒå±äººåŒ–ã—ã¦ã„ã‚‹
ãƒ»æƒ³å®šï¼šæ‹…å½“å·¥æ•°ãŒé€±ã«åˆè¨ˆæ•°æ™‚é–“å¢—ãˆã‚‹å¯èƒ½æ€§
ãƒ»é–¢ä¿‚è€…ï¼šå–¶æ¥­/CS/åˆ¶ä½œï¼ˆæœ€çµ‚ç¢ºèªè€…ãŒæœªå®šï¼‰
ãƒ»ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼šæ¥æœˆä¸­ã«æ–¹é‡æ±ºã‚ â†’ æ¥æœŸé ­ã§é–‹å§‹ã—ãŸã„ï¼ˆç¢ºå®šã§ã¯ãªã„ï¼‰
ãƒ»åˆ¤æ–­ææ–™ï¼šéå»æ–½ç­–ã®æ¯”è¼ƒãªã—ï¼æˆæœæŒ‡æ¨™ãŒæ›–æ˜§ï¼å¯¾è±¡ç¯„å›²ãŒåºƒã„
ãƒ»æ‡¸å¿µï¼šç¾å ´ä»»ã›ã§å“è³ªãŒãƒãƒ©ã¤ããã†`;

    const DEMO_3 = `ã€ä¸Šå¸ãƒ¬ãƒ“ãƒ¥ãƒ¼å¾…ã¡ãƒ¡ãƒ¢ï¼ˆãã‚Œã£ã½ã„ãŒåˆ¤æ–­ã§ããªã„ï¼‰ã€‘
ä»Šå›ã®æ–½ç­–ã¯èªçŸ¥æ‹¡å¤§ã‚’ç›®çš„ã¨ã—ãŸã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³ã§ã™ã€‚
SNSã‚’ä¸­å¿ƒã«å±•é–‹ã—ã€ãƒ–ãƒ©ãƒ³ãƒ‰ã‚¤ãƒ¡ãƒ¼ã‚¸ã®å‘ä¸Šã‚’ç‹™ã„ã¾ã™ã€‚
ç«¶åˆã‚‚åŒæ§˜ã®æ–½ç­–ã‚’è¡Œã£ã¦ã„ã‚‹ãŸã‚ã€å·®åˆ¥åŒ–ãŒé‡è¦ã§ã™ã€‚
æƒ³å®šã®å®Ÿæ–½æœŸé–“ã¯æ•°é€±é–“ã€œæ•°ã‹æœˆã‚’æƒ³å®šã—ã¦ã„ã¾ã™ãŒç¢ºå®šã—ã¦ã„ã¾ã›ã‚“ã€‚
è©³ç´°ãªæ•°å€¤è¨­è¨ˆãƒ»æ‹…å½“ä½“åˆ¶ãƒ»ç¢ºèªãƒ•ãƒ­ãƒ¼ã¯ä»Šå¾Œè©°ã‚ã¦ã„ãã¾ã™ã€‚`;

    const DEMOS = [DEMO_1, DEMO_2, DEMO_3];

    // ----------------------------
    // UI helpers
    // ----------------------------
    const el = (id) => document.getElementById(id);
    const inputText = el("inputText");
    const outputArea = el("outputArea");
    const toast = el("toast");
    const demoTag = el("demoTag");
    const modeBadge = el("modeBadge");

    const tabDemo = el("tabDemo");
    const tabUser = el("tabUser");
    const btnInsertDemo = el("btnInsertDemo");
    const btnClear = el("btnClear");
    const btnRun = el("btnRun");

    let mode = "demo"; // demo | user
    let demoIndex = 0;

    function showToast(msg){
      toast.textContent = msg;
      toast.classList.add("show");
      setTimeout(()=> toast.classList.remove("show"), 1400);
    }

    function setMode(next){
      mode = next;
      const isDemo = mode === "demo";

      tabDemo.classList.toggle("active", isDemo);
      tabUser.classList.toggle("active", !isDemo);
      tabDemo.setAttribute("aria-selected", isDemo ? "true" : "false");
      tabUser.setAttribute("aria-selected", !isDemo ? "true" : "false");

      modeBadge.textContent = isDemo ? "ãƒ‡ãƒ¢å…¥åŠ›" : "è‡ªåˆ†ã§å…¥åŠ›";
      demoTag.style.display = "none";

      if (isDemo){
        inputText.placeholder = "ï¼ˆãƒ‡ãƒ¢ï¼‰å…¥åŠ›ä¾‹ãŒå…¥ã‚Šã¾ã™ã€‚å¿…è¦ãªã‚‰å†…å®¹ã‚’æ›¸ãæ›ãˆã¦ãã ã•ã„ã€‚";
        insertDemo(true); // åˆ‡æ›¿æ™‚ã¯å¿…ãšç½®æ›ã§å…¥ã‚Œã‚‹ï¼ˆã‚¯ãƒªã‚¢ä¸è¦ï¼‰
      } else {
        inputText.value = ""; // è‡ªåˆ†ã§ã«åˆ‡æ›¿æ™‚ã¯å¿…ãšç©ºã«ã™ã‚‹ï¼ˆæ··ç·šé˜²æ­¢ï¼‰
        inputText.placeholder = "ç®‡æ¡æ›¸ããƒ»é€”ä¸­ãƒ¡ãƒ¢ã§OKï¼ˆå›ºæœ‰åè©ã¨å›ºæœ‰ã®æ•°å­—ã¯å…¥ã‚Œãªã„ï¼‰";
        outputArea.innerHTML = `<div class="empty">å…¥åŠ›ã—ã¦ã€Œè¦ç‚¹ã‚’æ•´ç†ã—ã¦è¦‹ã‚‹ã€ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚</div>`;
      }
    }

    function insertDemo(fromToggle=false){
      // æŠ¼ã™ãŸã³ã«åˆ¥ä¾‹ã¸ï¼ˆå¿…ãšç½®æ›ï¼‰
      demoIndex = (demoIndex + 1) % DEMOS.length;
      inputText.value = DEMOS[demoIndex];
      demoTag.style.display = "none";
      outputArea.innerHTML = `<div class="empty">ã€Œè¦ç‚¹ã‚’æ•´ç†ã—ã¦è¦‹ã‚‹ã€ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚</div>`;

      if (fromToggle) showToast("ãƒ‡ãƒ¢å…¥åŠ›ã«åˆ‡ã‚Šæ›¿ãˆã¾ã—ãŸ");
      else showToast("å…¥åŠ›ä¾‹ã‚’åˆ‡ã‚Šæ›¿ãˆã¾ã—ãŸ");
    }

    function clearAll(){
      inputText.value = "";
      demoTag.style.display = "none";
      outputArea.innerHTML = `<div class="empty">ã€Œå…¥åŠ›ä¾‹ã€â†’ã€Œè¦ç‚¹ã‚’æ•´ç†ã—ã¦è¦‹ã‚‹ã€ã‚’è©¦ã—ã¦ãã ã•ã„ã€‚</div>`;
      showToast("ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ");
    }

    // ----------------------------
    // Core: judgement-first structuring (no external calls)
    // ----------------------------
    function analyze(text){
      const raw = text.trim();
      const lines = raw.split(/\n+/).map(s=>s.trim()).filter(Boolean);

      const keywordsUndecided = ["æœªå®š","æœªç¢ºå®š","æ¤œè¨","ä»Šå¾Œ","è©°ã‚ã‚‹","è¦æ•´ç†","å·®åˆ¥åŒ–","åŸºæº–æœªå®š","æƒ³å®š","ç†æƒ³","ç¢ºå®šã§ã¯ãªã„","æœªå–å¾—","æœªæ•´ç†","æœªè¨­å®š"];
      const keywordsRisk = ["æ‡¸å¿µ","ãƒªã‚¹ã‚¯","ç‚ä¸Š","ã‚¯ãƒ¬ãƒ¼ãƒ ","ã‚ºãƒ¬","èª¤è§£","æ³•å‹™","æƒ…ã‚·ã‚¹","å¥‘ç´„","å€‹äººæƒ…å ±","æ¼ãˆã„","æœªå…¬é–‹","å±äºº","å“è³ª","ã°ã‚‰ã¤"];

      const found = { undecided: [], risk: [] };
      const hasAny = (l, arr) => arr.some(k => l.includes(k));

      for (const l of lines){
        if (hasAny(l, keywordsUndecided)) found.undecided.push(l);
        if (hasAny(l, keywordsRisk)) found.risk.push(l);
      }

      const facts = lines.filter(l => /^([ãƒ»\-]|(\d+[\.\)]))/.test(l)).slice(0, 5);
      const undec = found.undecided.slice(0, 4);

      const joined = raw;
      const missing = [];
      const hasTarget = /å¯¾è±¡|ã‚¿ãƒ¼ã‚²ãƒƒãƒˆ/.test(joined);
      const hasTiming = /æ™‚æœŸ|æœŸé–“|ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«|æ¥æœˆ|æ¥æœŸ|ã„ã¤|æ•°é€±é–“|æ•°ã‹æœˆ/.test(joined);
      const hasMetric = /æŒ‡æ¨™|KPI|æˆæœ|åå¿œç‡|CV|CTR|å¿œå‹Ÿ|è§£ç´„|é›¢è„±|å•ã„åˆã‚ã›/.test(joined);
      const hasScope = /ç¯„å›²|å¯¾è±¡å¤–|å„ªå…ˆ|ã‚„ã‚‰ãªã„|é™å®š/.test(joined);
      const hasOwner = /æ‹…å½“|è²¬ä»»|ã‚ªãƒ¼ãƒŠãƒ¼|æœ€çµ‚ç¢ºèª|èª°ãŒ|é–¢ä¿‚è€…/.test(joined);
      const hasCompare = /æ¯”è¼ƒ|éå»|å®Ÿç¸¾|å‰å¹´å·®|å‰å›/.test(joined);

      if (!hasTarget) missing.push("å¯¾è±¡ï¼ˆèª°ã«å½±éŸ¿ã™ã‚‹/ç¯„å›²ï¼‰ãŒä¸æ˜");
      if (!hasTiming) missing.push("ã‚¿ã‚¤ãƒŸãƒ³ã‚°ï¼ˆã„ã¤åˆ¤æ–­ãŒå¿…è¦ã‹ï¼‰ãŒä¸æ˜");
      if (!hasMetric) missing.push("æˆæœæŒ‡æ¨™ï¼ˆä½•ã‚’è¦‹ã¦è‰¯ã—æ‚ªã—ã‚’æ±ºã‚ã‚‹ã‹ï¼‰ãŒä¸æ˜");
      if (!hasScope) missing.push("ã‚¹ã‚³ãƒ¼ãƒ—ï¼ˆã‚„ã‚‹/ã‚„ã‚‰ãªã„ãƒ»å„ªå…ˆé †ä½ï¼‰ãŒä¸æ˜");
      if (!hasOwner) missing.push("è²¬ä»»è€…/ç¢ºèªè€…ï¼ˆèª°ãŒæœ€çµ‚ç¢ºèªã™ã‚‹ã‹ï¼‰ãŒä¸æ˜");
      if (!hasCompare) missing.push("æ ¹æ‹ ï¼ˆéå»/æ¯”è¼ƒãƒ‡ãƒ¼ã‚¿ï¼‰ãŒä¸è¶³");

      // Decision points (Yes/Noåˆ†å²ã¨ã—ã¦çŸ­ãï¼‰
      const decisionPoints = [];
      if (/æ—¢å­˜|æ–°è¦/.test(joined)) decisionPoints.push("å¯¾è±¡ã‚’ã€Œæ—¢å­˜ä¸­å¿ƒã€ã‹ã€Œæ–°è¦ä¸­å¿ƒã€ã‹");
      if (/èªçŸ¥|ãƒ–ãƒ©ãƒ³ãƒ‰/.test(joined)) decisionPoints.push("ç›®çš„ã‚’ã€ŒèªçŸ¥ã€å„ªå…ˆã‹ã€Œç²å¾—/é›¢è„±æŠ‘åˆ¶ã€å„ªå…ˆã‹");
      if (/äºˆç®—|ã‚³ã‚¹ãƒˆ|ä¸‡å††|ãƒ¬ãƒ³ã‚¸/.test(joined)) decisionPoints.push("è²»ç”¨ä¸Šé™ï¼ˆãƒ¬ãƒ³ã‚¸ï¼‰ã‚’å…ˆã«æ±ºã‚ã‚‹ã‹");
      if (/SNS|åºƒå‘Š|ãƒ¡ãƒ¼ãƒ«|LINE|åŒæ¢±/.test(joined)) decisionPoints.push("ãƒãƒ£ãƒãƒ«ã‚’ã€Œå˜ç‹¬ã€ã‹ã€Œä½µç”¨ã€ã‹");
      if (/å·®åˆ¥åŒ–|ç«¶åˆ/.test(joined)) decisionPoints.push("å·®åˆ¥åŒ–ã‚’ã€Œè¨€è‘‰/ã‚ªãƒ•ã‚¡ãƒ¼/ä½“é¨“ã€ã®ã©ã“ã§ä½œã‚‹ã‹");
      if (/å·¥æ•°|å±äºº|ä½“åˆ¶|æœ€çµ‚ç¢ºèª/.test(joined)) decisionPoints.push("é‹ç”¨ä½“åˆ¶ï¼ˆæœ€çµ‚ç¢ºèªè€…/ãƒ¬ãƒ“ãƒ¥ãƒ¼æ‰‹é †ï¼‰ã‚’å…ˆã«æ±ºã‚ã‚‹ã‹");

      const cautions = [];
      if (found.risk.length) cautions.push("æ‡¸å¿µç‚¹ã¯å‡ºã¦ã„ã‚‹ãŒã€å„ªå…ˆé †ä½ãŒæœªè¨­å®šï¼ˆã©ã‚ŒãŒæœ€é‡è¦ã‹ä¸æ˜ï¼‰");
      if (!/æ ¹æ‹ |ãƒ‡ãƒ¼ã‚¿|æ¯”è¼ƒ|éå»|å®Ÿç¸¾/.test(joined)) cautions.push("æ ¹æ‹ ï¼ˆéå»æ–½ç­–ã®çµæœ/æ¯”è¼ƒï¼‰ãŒä¸è¶³ã—ã€åˆ¤æ–­ãŒæ„Ÿè¦šã«å¯„ã‚Šã‚„ã™ã„");
      if (/ä¸‡å††|å£²ä¸Š|äººäº‹|æ¡ˆä»¶/.test(joined)) cautions.push("å›ºæœ‰ã®æ•°å€¤ãƒ»æœªå…¬é–‹æƒ…å ±ã¯å…¥åŠ›ã—ãªã„é‹ç”¨ãŒå¿…è¦ï¼ˆãƒ¬ãƒ³ã‚¸è¡¨ç¾ã«ç½®æ›ï¼‰");
      cautions.push("å‡ºåŠ›ã¯è¦ç‚¹æ•´ç†ã®ã¿ã€‚æœ€çµ‚åˆ¤æ–­ãƒ»å¯¾å¤–ç™ºä¿¡ã¯äººãŒè²¬ä»»ã‚’æŒã¤å‰æ");

      const block1 = [];
      if (facts.length) block1.push(`å‰æï¼ˆæ›¸ã‹ã‚Œã¦ã„ã‚‹ã“ã¨ï¼‰ï¼š${facts.map(s=>s.replace(/^([ãƒ»\-]\s*)/,"")).join(" / ")}`);
      if (undec.length) block1.push(`æœªç¢ºå®šï¼ˆåˆ¤æ–­å‰ã«åŸ‹ã‚ãŸã„ï¼‰ï¼š${undec.map(s=>s.replace(/^([ãƒ»\-]\s*)/,"")).join(" / ")}`);
      if (missing.length) block1.push(`è¿½åŠ ã§ç¢ºèªãŒå¿…è¦ï¼š${missing.slice(0,3).join(" / ")}`);

      const block2 = (decisionPoints.length ? decisionPoints : [
        "ç›®çš„ï¼ˆä½•ã‚’é”æˆã—ãŸã„ã‹ï¼‰ã‚’ä¸€è¨€ã§å›ºå®šã™ã‚‹",
        "å¯¾è±¡ï¼ˆèª°ã«å½±éŸ¿ã™ã‚‹ã‹ï¼‰ã‚’é™å®šã™ã‚‹",
        "æˆåŠŸã®åˆ¤æ–­åŸºæº–ï¼ˆä½•ã‚’è¦‹ã¦è‰¯ã—æ‚ªã—ã‚’æ±ºã‚ã‚‹ã‹ï¼‰ã‚’æ±ºã‚ã‚‹"
      ]).slice(0,6);

      const block3 = cautions.slice(0,6);

      return { block1, block2, block3 };
    }

    function escapeHtml(s){
      return s.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;")
              .replaceAll('"',"&quot;").replaceAll("'","&#039;");
    }

    function renderOutput({block1, block2, block3}, isDemo){
      demoTag.style.display = isDemo ? "inline-flex" : "none";
      outputArea.innerHTML = `
        <div class="outcard">
          <h3>â‘  ã¾ãšæŠŠæ¡ã™ã¹ãå‰æ <span class="tag">ã“ã“ã ã‘</span></h3>
          <ul>${(block1.length ? block1 : ["å…¥åŠ›ãŒçŸ­ã™ãã¾ã™ã€‚ç®‡æ¡æ›¸ãã§3ã€œ5è¡Œã»ã©è¿½åŠ ã—ã¦ãã ã•ã„ã€‚"])
            .map(li=>`<li>${escapeHtml(li)}</li>`).join("")}</ul>
        </div>
        <div class="outcard">
          <h3>â‘¡ åˆ¤æ–­å‰ã«è¦‹ã‚‹ã¹ããƒã‚¤ãƒ³ãƒˆ <span class="tag">åˆ†å²</span></h3>
          <ul>${block2.map(li=>`<li>${escapeHtml(li)}</li>`).join("")}</ul>
        </div>
        <div class="outcard">
          <h3>â‘¢ å¿µã®ãŸã‚æ³¨æ„ã—ãŸã„ç‚¹ <span class="tag">äº‹æ•…é˜²æ­¢</span></h3>
          <ul>${block3.map(li=>`<li>${escapeHtml(li)}</li>`).join("")}</ul>
        </div>
      `;
    }

    // ----------------------------
    // Optional: Voice input (Web Speech API)
    // - Shown only if supported
    // - No saving / no sending
    // ----------------------------
    let recognition = null;
    let listening = false;

    function setupVoiceIfAvailable(){
      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      const btnVoice = el("btnVoice");
      if (!SpeechRecognition) return; // éå¯¾å¿œãªã‚‰å‡ºã•ãªã„

      recognition = new SpeechRecognition();
      recognition.lang = "ja-JP";
      recognition.interimResults = true;
      recognition.continuous = false;

      btnVoice.style.display = "inline-block";

      recognition.onresult = (event) => {
        let transcript = "";
        for (let i = event.resultIndex; i < event.results.length; i++){
          transcript += event.results[i][0].transcript;
        }
        // ç½®æ›ã§ã¯ãªãè¿½è¨˜ï¼ˆæ—¢å­˜ãƒ†ã‚­ã‚¹ãƒˆã¯æ¶ˆã•ãªã„ï¼‰
        const prefix = inputText.value.trim() ? (inputText.value.trim() + "\n") : "";
        inputText.value = prefix + transcript.trim();
      };

      recognition.onend = () => {
        listening = false;
        btnVoice.textContent = "éŸ³å£°å…¥åŠ›ï¼ˆÎ²ï¼‰";
        showToast("éŸ³å£°å…¥åŠ›ã‚’åœæ­¢ã—ã¾ã—ãŸ");
      };

      btnVoice.addEventListener("click", () => {
        if (!recognition) return;
        if (listening){
          recognition.stop();
          return;
        }
        try{
          listening = true;
          btnVoice.textContent = "åœæ­¢";
          recognition.start();
          showToast("è©±ã—ãŸå†…å®¹ã‚’å…¥åŠ›æ¬„ã«å…¥ã‚Œã¾ã™ï¼ˆç«¯æœ«ã®éŸ³å£°èªè­˜ï¼‰");
        }catch(e){
          listening = false;
          btnVoice.textContent = "éŸ³å£°å…¥åŠ›ï¼ˆÎ²ï¼‰";
          showToast("éŸ³å£°å…¥åŠ›ã‚’é–‹å§‹ã§ãã¾ã›ã‚“ã§ã—ãŸ");
        }
      });
    }

    // ----------------------------
    // Events
    // ----------------------------
    tabDemo.addEventListener("click", ()=> setMode("demo"));
    tabUser.addEventListener("click", ()=> setMode("user"));

    btnInsertDemo.addEventListener("click", ()=>{
      // å…¥åŠ›ä¾‹ã¯ã€Œå¿…ãšç½®æ›ã€ã§åˆ‡æ›¿ï¼ˆã‚¯ãƒªã‚¢ä¸è¦ï¼‰
      if (mode !== "demo") setMode("demo");
      else insertDemo(false);
    });

    btnClear.addEventListener("click", clearAll);

    btnRun.addEventListener("click", ()=>{
      const t = inputText.value.trim();
      if (!t){ showToast("ã¾ãšå…¥åŠ›ã—ã¦ãã ã•ã„"); return; }
      renderOutput(analyze(t), (mode === "demo"));
      showToast("è¦ç‚¹ã‚’æ•´ç†ã—ã¾ã—ãŸ");
    });

    // init
    setMode("demo");      // ãƒ‡ãƒ¢ã«åˆ‡æ›¿ï¼å¿…ãšãƒ‡ãƒ¢ä¾‹ãŒå…¥ã‚‹
    setupVoiceIfAvailable();
  </script>
</body>
</html>
